# Comparing `tmp/kaiju_tools-2.0.46-py3-none-any.whl.zip` & `tmp/kaiju_tools-2.0.47-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,113 +1,113 @@
-Zip file size: 127610 bytes, number of entries: 111
--rw-r--r--  2.0 unx     3424 b- defN 23-Apr-18 15:23 kaiju_tools/CLI.py
--rw-r--r--  2.0 unx      272 b- defN 23-Apr-18 15:23 kaiju_tools/__init__.py
--rw-r--r--  2.0 unx     7473 b- defN 23-Apr-18 15:23 kaiju_tools/class_registry.py
--rw-r--r--  2.0 unx     5923 b- defN 23-Apr-18 15:23 kaiju_tools/exceptions.py
--rw-r--r--  2.0 unx      997 b- defN 23-Apr-18 15:23 kaiju_tools/fixtures.py
--rw-r--r--  2.0 unx     8965 b- defN 23-Apr-18 15:23 kaiju_tools/functions.py
--rw-r--r--  2.0 unx     2172 b- defN 23-Apr-18 15:23 kaiju_tools/init_app.py
--rw-r--r--  2.0 unx    18691 b- defN 23-Apr-18 15:23 kaiju_tools/jsonschema.py
--rw-r--r--  2.0 unx      195 b- defN 23-Apr-18 15:23 kaiju_tools/loop.py
--rw-r--r--  2.0 unx    13521 b- defN 23-Apr-18 15:23 kaiju_tools/mapping.py
--rw-r--r--  2.0 unx      159 b- defN 23-Apr-18 15:23 kaiju_tools/serialization.py
--rw-r--r--  2.0 unx     8221 b- defN 23-Apr-18 15:23 kaiju_tools/services.py
--rw-r--r--  2.0 unx    14345 b- defN 23-Apr-18 15:23 kaiju_tools/templates.py
--rw-r--r--  2.0 unx     4793 b- defN 23-Apr-18 15:23 kaiju_tools/ttl_dict.py
--rw-r--r--  2.0 unx     3691 b- defN 23-Apr-18 15:23 kaiju_tools/types.py
--rw-r--r--  2.0 unx     2595 b- defN 23-Apr-18 15:23 kaiju_tools/cache/__init__.py
--rw-r--r--  2.0 unx    11339 b- defN 23-Apr-18 15:23 kaiju_tools/cache/abc.py
--rw-r--r--  2.0 unx     2373 b- defN 23-Apr-18 15:23 kaiju_tools/cache/local_cache.py
--rw-r--r--  2.0 unx       43 b- defN 23-Apr-18 15:23 kaiju_tools/cache/services.py
--rw-r--r--  2.0 unx        0 b- defN 23-Apr-18 15:23 kaiju_tools/cache/tests/__init__.py
--rw-r--r--  2.0 unx     2315 b- defN 23-Apr-18 15:23 kaiju_tools/cache/tests/test_cache.py
--rw-r--r--  2.0 unx        0 b- defN 23-Apr-18 15:23 kaiju_tools/commands/__init__.py
--rw-r--r--  2.0 unx      932 b- defN 23-Apr-18 15:23 kaiju_tools/config/__init__.py
--rw-r--r--  2.0 unx     7661 b- defN 23-Apr-18 15:23 kaiju_tools/config/config_loader.py
--rw-r--r--  2.0 unx     2975 b- defN 23-Apr-18 15:23 kaiju_tools/config/configurator.py
--rw-r--r--  2.0 unx        0 b- defN 23-Apr-18 15:23 kaiju_tools/config/tests/__init__.py
--rw-r--r--  2.0 unx      586 b- defN 23-Apr-18 15:23 kaiju_tools/config/tests/test_configurator.py
--rw-r--r--  2.0 unx      276 b- defN 23-Apr-18 15:23 kaiju_tools/docker/__init__.py
--rw-r--r--  2.0 unx     9554 b- defN 23-Apr-18 15:23 kaiju_tools/docker/containers.py
--rw-r--r--  2.0 unx     7830 b- defN 23-Apr-18 15:23 kaiju_tools/docker/images.py
--rw-r--r--  2.0 unx      103 b- defN 23-Apr-18 15:23 kaiju_tools/docker/services.py
--rw-r--r--  2.0 unx    11140 b- defN 23-Apr-18 15:23 kaiju_tools/docker/stack.py
--rw-r--r--  2.0 unx        0 b- defN 23-Apr-18 15:23 kaiju_tools/docker/tests/__init__.py
--rw-r--r--  2.0 unx     1625 b- defN 23-Apr-18 15:23 kaiju_tools/docker/tests/fixtures.py
--rw-r--r--  2.0 unx      575 b- defN 23-Apr-18 15:23 kaiju_tools/docker/tests/test_containers.py
--rw-r--r--  2.0 unx      359 b- defN 23-Apr-18 15:23 kaiju_tools/docker/tests/test_images.py
--rw-r--r--  2.0 unx      371 b- defN 23-Apr-18 15:23 kaiju_tools/docker/tests/test_stack.py
--rw-r--r--  2.0 unx       65 b- defN 23-Apr-18 15:23 kaiju_tools/encoding/__init__.py
--rw-r--r--  2.0 unx     2996 b- defN 23-Apr-18 15:23 kaiju_tools/encoding/abc.py
--rw-r--r--  2.0 unx      163 b- defN 23-Apr-18 15:23 kaiju_tools/encoding/etc.py
--rw-r--r--  2.0 unx     4440 b- defN 23-Apr-18 15:23 kaiju_tools/encoding/json.py
--rw-r--r--  2.0 unx     4472 b- defN 23-Apr-18 15:23 kaiju_tools/encoding/msgpack.py
--rw-r--r--  2.0 unx      654 b- defN 23-Apr-18 15:23 kaiju_tools/encoding/serializers.py
--rw-r--r--  2.0 unx        0 b- defN 23-Apr-18 15:23 kaiju_tools/encoding/tests/__init__.py
--rw-r--r--  2.0 unx      335 b- defN 23-Apr-18 15:23 kaiju_tools/encoding/tests/fixtures.py
--rw-r--r--  2.0 unx     1930 b- defN 23-Apr-18 15:23 kaiju_tools/encoding/tests/test_msgpack.py
--rw-r--r--  2.0 unx      325 b- defN 23-Apr-18 15:23 kaiju_tools/encoding/tests/test_serializers.py
--rw-r--r--  2.0 unx       46 b- defN 23-Apr-18 15:23 kaiju_tools/es/__init__.py
--rw-r--r--  2.0 unx    18302 b- defN 23-Apr-18 15:23 kaiju_tools/es/client.py
--rw-r--r--  2.0 unx     5559 b- defN 23-Apr-18 15:23 kaiju_tools/es/loader.py
--rw-r--r--  2.0 unx    17588 b- defN 23-Apr-18 15:23 kaiju_tools/es/schema.py
--rw-r--r--  2.0 unx       66 b- defN 23-Apr-18 15:23 kaiju_tools/es/services.py
--rw-r--r--  2.0 unx        0 b- defN 23-Apr-18 15:23 kaiju_tools/es/tests/__init__.py
--rw-r--r--  2.0 unx     3463 b- defN 23-Apr-18 15:23 kaiju_tools/es/tests/fixtures.py
--rw-r--r--  2.0 unx       32 b- defN 23-Apr-18 15:23 kaiju_tools/http/__init__.py
--rw-r--r--  2.0 unx     6055 b- defN 23-Apr-18 15:23 kaiju_tools/http/client.py
--rw-r--r--  2.0 unx     1238 b- defN 23-Apr-18 15:23 kaiju_tools/http/middlewares.py
--rw-r--r--  2.0 unx     2564 b- defN 23-Apr-18 15:23 kaiju_tools/http/views.py
--rw-r--r--  2.0 unx        0 b- defN 23-Apr-18 15:23 kaiju_tools/http/tests/__init__.py
--rw-r--r--  2.0 unx     1532 b- defN 23-Apr-18 15:23 kaiju_tools/http/tests/test_client.py
--rw-r--r--  2.0 unx     2392 b- defN 23-Apr-18 15:23 kaiju_tools/http/tests/test_rpc_rest_view.py
--rw-r--r--  2.0 unx     2344 b- defN 23-Apr-18 15:23 kaiju_tools/locks/__init__.py
--rw-r--r--  2.0 unx     9911 b- defN 23-Apr-18 15:23 kaiju_tools/locks/abc.py
--rw-r--r--  2.0 unx      393 b- defN 23-Apr-18 15:23 kaiju_tools/locks/etc.py
--rw-r--r--  2.0 unx      284 b- defN 23-Apr-18 15:23 kaiju_tools/locks/exceptions.py
--rw-r--r--  2.0 unx        0 b- defN 23-Apr-18 15:23 kaiju_tools/locks/tests/__init__.py
--rw-r--r--  2.0 unx     1913 b- defN 23-Apr-18 15:23 kaiju_tools/locks/tests/test_locks.py
--rw-r--r--  2.0 unx        0 b- defN 23-Apr-18 15:23 kaiju_tools/logging/__init__.py
--rw-r--r--  2.0 unx     3355 b- defN 23-Apr-18 15:23 kaiju_tools/logging/services.py
--rw-r--r--  2.0 unx    10173 b- defN 23-Apr-18 15:23 kaiju_tools/logging/types.py
--rw-r--r--  2.0 unx        0 b- defN 23-Apr-18 15:23 kaiju_tools/logging/tests/__init__.py
--rw-r--r--  2.0 unx     1827 b- defN 23-Apr-18 15:23 kaiju_tools/logging/tests/test_loggers.py
--rw-r--r--  2.0 unx       43 b- defN 23-Apr-18 15:23 kaiju_tools/queues/__init__.py
--rw-r--r--  2.0 unx    12777 b- defN 23-Apr-18 15:23 kaiju_tools/queues/abc.py
--rw-r--r--  2.0 unx     3828 b- defN 23-Apr-18 15:23 kaiju_tools/queues/queue.py
--rw-r--r--  2.0 unx       33 b- defN 23-Apr-18 15:23 kaiju_tools/queues/services.py
--rw-r--r--  2.0 unx        0 b- defN 23-Apr-18 15:23 kaiju_tools/queues/tests/__init__.py
--rw-r--r--  2.0 unx      722 b- defN 23-Apr-18 15:23 kaiju_tools/queues/tests/fixtures.py
--rw-r--r--  2.0 unx     1371 b- defN 23-Apr-18 15:23 kaiju_tools/queues/tests/test_queue.py
--rw-r--r--  2.0 unx       43 b- defN 23-Apr-18 15:23 kaiju_tools/rpc/__init__.py
--rw-r--r--  2.0 unx    11883 b- defN 23-Apr-18 15:23 kaiju_tools/rpc/abc.py
--rw-r--r--  2.0 unx     4991 b- defN 23-Apr-18 15:23 kaiju_tools/rpc/client.py
--rw-r--r--  2.0 unx     3825 b- defN 23-Apr-18 15:23 kaiju_tools/rpc/client_gen.py
--rw-r--r--  2.0 unx      116 b- defN 23-Apr-18 15:23 kaiju_tools/rpc/context.py
--rw-r--r--  2.0 unx      544 b- defN 23-Apr-18 15:23 kaiju_tools/rpc/etc.py
--rw-r--r--  2.0 unx     1831 b- defN 23-Apr-18 15:23 kaiju_tools/rpc/jsonrpc.py
--rw-r--r--  2.0 unx    19150 b- defN 23-Apr-18 15:23 kaiju_tools/rpc/server.py
--rw-r--r--  2.0 unx       71 b- defN 23-Apr-18 15:23 kaiju_tools/rpc/services.py
--rw-r--r--  2.0 unx     6040 b- defN 23-Apr-18 15:23 kaiju_tools/rpc/sessions.py
--rw-r--r--  2.0 unx        0 b- defN 23-Apr-18 15:23 kaiju_tools/rpc/tests/__init__.py
--rw-r--r--  2.0 unx     4207 b- defN 23-Apr-18 15:23 kaiju_tools/rpc/tests/fixtures.py
--rw-r--r--  2.0 unx     7972 b- defN 23-Apr-18 15:23 kaiju_tools/rpc/tests/test_rpc_server.py
--rw-r--r--  2.0 unx       38 b- defN 23-Apr-18 15:23 kaiju_tools/streams/__init__.py
--rw-r--r--  2.0 unx    24457 b- defN 23-Apr-18 15:23 kaiju_tools/streams/abc.py
--rw-r--r--  2.0 unx      152 b- defN 23-Apr-18 15:23 kaiju_tools/streams/etc.py
--rw-r--r--  2.0 unx        0 b- defN 23-Apr-18 15:23 kaiju_tools/streams/tests/__init__.py
--rw-r--r--  2.0 unx        0 b- defN 23-Apr-18 15:23 kaiju_tools/streams/tests/fixtures.py
--rw-r--r--  2.0 unx     5975 b- defN 23-Apr-18 15:23 kaiju_tools/streams/tests/test_streams.py
--rw-r--r--  2.0 unx        0 b- defN 23-Apr-18 15:23 kaiju_tools/tests/__init__.py
--rw-r--r--  2.0 unx     2016 b- defN 23-Apr-18 15:23 kaiju_tools/tests/fixtures.py
--rw-r--r--  2.0 unx     1408 b- defN 23-Apr-18 15:23 kaiju_tools/tests/test_class_registry.py
--rw-r--r--  2.0 unx     3385 b- defN 23-Apr-18 15:23 kaiju_tools/tests/test_mapping.py
--rw-r--r--  2.0 unx      481 b- defN 23-Apr-18 15:23 kaiju_tools/tests/test_serialization.py
--rw-r--r--  2.0 unx     2787 b- defN 23-Apr-18 15:23 kaiju_tools/tests/test_services.py
--rw-r--r--  2.0 unx     1554 b- defN 23-Apr-18 15:23 kaiju_tools/tests/test_templates.py
--rw-r--r--  2.0 unx      796 b- defN 23-Apr-18 15:23 kaiju_tools/tests/test_ttl_dict.py
--rw-rw-rw-  2.0 unx      610 b- defN 23-Apr-18 15:23 kaiju_tools-2.0.46.dist-info/LICENSE
--rw-r--r--  2.0 unx     3236 b- defN 23-Apr-18 15:23 kaiju_tools-2.0.46.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-Apr-18 15:23 kaiju_tools-2.0.46.dist-info/WHEEL
--rw-r--r--  2.0 unx       12 b- defN 23-Apr-18 15:23 kaiju_tools-2.0.46.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     9622 b- defN 23-Apr-18 15:23 kaiju_tools-2.0.46.dist-info/RECORD
-111 files, 395979 bytes uncompressed, 112292 bytes compressed:  71.6%
+Zip file size: 128060 bytes, number of entries: 111
+-rw-r--r--  2.0 unx     3424 b- defN 23-Apr-19 12:08 kaiju_tools/CLI.py
+-rw-r--r--  2.0 unx      272 b- defN 23-Apr-19 12:08 kaiju_tools/__init__.py
+-rw-r--r--  2.0 unx     7473 b- defN 23-Apr-19 12:08 kaiju_tools/class_registry.py
+-rw-r--r--  2.0 unx     6013 b- defN 23-Apr-19 12:08 kaiju_tools/exceptions.py
+-rw-r--r--  2.0 unx      997 b- defN 23-Apr-19 12:08 kaiju_tools/fixtures.py
+-rw-r--r--  2.0 unx     8965 b- defN 23-Apr-19 12:08 kaiju_tools/functions.py
+-rw-r--r--  2.0 unx     2172 b- defN 23-Apr-19 12:08 kaiju_tools/init_app.py
+-rw-r--r--  2.0 unx    18691 b- defN 23-Apr-19 12:08 kaiju_tools/jsonschema.py
+-rw-r--r--  2.0 unx      195 b- defN 23-Apr-19 12:08 kaiju_tools/loop.py
+-rw-r--r--  2.0 unx    13521 b- defN 23-Apr-19 12:08 kaiju_tools/mapping.py
+-rw-r--r--  2.0 unx      159 b- defN 23-Apr-19 12:08 kaiju_tools/serialization.py
+-rw-r--r--  2.0 unx     8221 b- defN 23-Apr-19 12:08 kaiju_tools/services.py
+-rw-r--r--  2.0 unx    14345 b- defN 23-Apr-19 12:08 kaiju_tools/templates.py
+-rw-r--r--  2.0 unx     4793 b- defN 23-Apr-19 12:08 kaiju_tools/ttl_dict.py
+-rw-r--r--  2.0 unx     3691 b- defN 23-Apr-19 12:08 kaiju_tools/types.py
+-rw-r--r--  2.0 unx     2595 b- defN 23-Apr-19 12:08 kaiju_tools/cache/__init__.py
+-rw-r--r--  2.0 unx    11339 b- defN 23-Apr-19 12:08 kaiju_tools/cache/abc.py
+-rw-r--r--  2.0 unx     2373 b- defN 23-Apr-19 12:08 kaiju_tools/cache/local_cache.py
+-rw-r--r--  2.0 unx       43 b- defN 23-Apr-19 12:08 kaiju_tools/cache/services.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Apr-19 12:08 kaiju_tools/cache/tests/__init__.py
+-rw-r--r--  2.0 unx     2315 b- defN 23-Apr-19 12:08 kaiju_tools/cache/tests/test_cache.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Apr-19 12:08 kaiju_tools/commands/__init__.py
+-rw-r--r--  2.0 unx      932 b- defN 23-Apr-19 12:08 kaiju_tools/config/__init__.py
+-rw-r--r--  2.0 unx     7661 b- defN 23-Apr-19 12:08 kaiju_tools/config/config_loader.py
+-rw-r--r--  2.0 unx     2975 b- defN 23-Apr-19 12:08 kaiju_tools/config/configurator.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Apr-19 12:08 kaiju_tools/config/tests/__init__.py
+-rw-r--r--  2.0 unx      586 b- defN 23-Apr-19 12:08 kaiju_tools/config/tests/test_configurator.py
+-rw-r--r--  2.0 unx      276 b- defN 23-Apr-19 12:08 kaiju_tools/docker/__init__.py
+-rw-r--r--  2.0 unx     9554 b- defN 23-Apr-19 12:08 kaiju_tools/docker/containers.py
+-rw-r--r--  2.0 unx     7830 b- defN 23-Apr-19 12:08 kaiju_tools/docker/images.py
+-rw-r--r--  2.0 unx      103 b- defN 23-Apr-19 12:08 kaiju_tools/docker/services.py
+-rw-r--r--  2.0 unx    11140 b- defN 23-Apr-19 12:08 kaiju_tools/docker/stack.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Apr-19 12:08 kaiju_tools/docker/tests/__init__.py
+-rw-r--r--  2.0 unx     1625 b- defN 23-Apr-19 12:08 kaiju_tools/docker/tests/fixtures.py
+-rw-r--r--  2.0 unx      575 b- defN 23-Apr-19 12:08 kaiju_tools/docker/tests/test_containers.py
+-rw-r--r--  2.0 unx      359 b- defN 23-Apr-19 12:08 kaiju_tools/docker/tests/test_images.py
+-rw-r--r--  2.0 unx      371 b- defN 23-Apr-19 12:08 kaiju_tools/docker/tests/test_stack.py
+-rw-r--r--  2.0 unx       65 b- defN 23-Apr-19 12:08 kaiju_tools/encoding/__init__.py
+-rw-r--r--  2.0 unx     2996 b- defN 23-Apr-19 12:08 kaiju_tools/encoding/abc.py
+-rw-r--r--  2.0 unx      163 b- defN 23-Apr-19 12:08 kaiju_tools/encoding/etc.py
+-rw-r--r--  2.0 unx     4440 b- defN 23-Apr-19 12:08 kaiju_tools/encoding/json.py
+-rw-r--r--  2.0 unx     4472 b- defN 23-Apr-19 12:08 kaiju_tools/encoding/msgpack.py
+-rw-r--r--  2.0 unx      654 b- defN 23-Apr-19 12:08 kaiju_tools/encoding/serializers.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Apr-19 12:08 kaiju_tools/encoding/tests/__init__.py
+-rw-r--r--  2.0 unx      335 b- defN 23-Apr-19 12:08 kaiju_tools/encoding/tests/fixtures.py
+-rw-r--r--  2.0 unx     1930 b- defN 23-Apr-19 12:08 kaiju_tools/encoding/tests/test_msgpack.py
+-rw-r--r--  2.0 unx      325 b- defN 23-Apr-19 12:08 kaiju_tools/encoding/tests/test_serializers.py
+-rw-r--r--  2.0 unx       46 b- defN 23-Apr-19 12:08 kaiju_tools/es/__init__.py
+-rw-r--r--  2.0 unx    18302 b- defN 23-Apr-19 12:08 kaiju_tools/es/client.py
+-rw-r--r--  2.0 unx     5559 b- defN 23-Apr-19 12:08 kaiju_tools/es/loader.py
+-rw-r--r--  2.0 unx    17588 b- defN 23-Apr-19 12:08 kaiju_tools/es/schema.py
+-rw-r--r--  2.0 unx       66 b- defN 23-Apr-19 12:08 kaiju_tools/es/services.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Apr-19 12:08 kaiju_tools/es/tests/__init__.py
+-rw-r--r--  2.0 unx     3463 b- defN 23-Apr-19 12:08 kaiju_tools/es/tests/fixtures.py
+-rw-r--r--  2.0 unx       32 b- defN 23-Apr-19 12:08 kaiju_tools/http/__init__.py
+-rw-r--r--  2.0 unx     6055 b- defN 23-Apr-19 12:08 kaiju_tools/http/client.py
+-rw-r--r--  2.0 unx     1238 b- defN 23-Apr-19 12:08 kaiju_tools/http/middlewares.py
+-rw-r--r--  2.0 unx     2742 b- defN 23-Apr-19 12:08 kaiju_tools/http/views.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Apr-19 12:08 kaiju_tools/http/tests/__init__.py
+-rw-r--r--  2.0 unx     1532 b- defN 23-Apr-19 12:08 kaiju_tools/http/tests/test_client.py
+-rw-r--r--  2.0 unx     2392 b- defN 23-Apr-19 12:08 kaiju_tools/http/tests/test_rpc_rest_view.py
+-rw-r--r--  2.0 unx     2344 b- defN 23-Apr-19 12:08 kaiju_tools/locks/__init__.py
+-rw-r--r--  2.0 unx     9911 b- defN 23-Apr-19 12:08 kaiju_tools/locks/abc.py
+-rw-r--r--  2.0 unx      393 b- defN 23-Apr-19 12:08 kaiju_tools/locks/etc.py
+-rw-r--r--  2.0 unx      284 b- defN 23-Apr-19 12:08 kaiju_tools/locks/exceptions.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Apr-19 12:08 kaiju_tools/locks/tests/__init__.py
+-rw-r--r--  2.0 unx     1913 b- defN 23-Apr-19 12:08 kaiju_tools/locks/tests/test_locks.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Apr-19 12:08 kaiju_tools/logging/__init__.py
+-rw-r--r--  2.0 unx     3355 b- defN 23-Apr-19 12:08 kaiju_tools/logging/services.py
+-rw-r--r--  2.0 unx    10173 b- defN 23-Apr-19 12:08 kaiju_tools/logging/types.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Apr-19 12:08 kaiju_tools/logging/tests/__init__.py
+-rw-r--r--  2.0 unx     1827 b- defN 23-Apr-19 12:08 kaiju_tools/logging/tests/test_loggers.py
+-rw-r--r--  2.0 unx       43 b- defN 23-Apr-19 12:08 kaiju_tools/queues/__init__.py
+-rw-r--r--  2.0 unx    12777 b- defN 23-Apr-19 12:08 kaiju_tools/queues/abc.py
+-rw-r--r--  2.0 unx     3828 b- defN 23-Apr-19 12:08 kaiju_tools/queues/queue.py
+-rw-r--r--  2.0 unx       33 b- defN 23-Apr-19 12:08 kaiju_tools/queues/services.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Apr-19 12:08 kaiju_tools/queues/tests/__init__.py
+-rw-r--r--  2.0 unx      722 b- defN 23-Apr-19 12:08 kaiju_tools/queues/tests/fixtures.py
+-rw-r--r--  2.0 unx     1371 b- defN 23-Apr-19 12:08 kaiju_tools/queues/tests/test_queue.py
+-rw-r--r--  2.0 unx       43 b- defN 23-Apr-19 12:08 kaiju_tools/rpc/__init__.py
+-rw-r--r--  2.0 unx    11883 b- defN 23-Apr-19 12:08 kaiju_tools/rpc/abc.py
+-rw-r--r--  2.0 unx     5111 b- defN 23-Apr-19 12:08 kaiju_tools/rpc/client.py
+-rw-r--r--  2.0 unx     3825 b- defN 23-Apr-19 12:08 kaiju_tools/rpc/client_gen.py
+-rw-r--r--  2.0 unx      116 b- defN 23-Apr-19 12:08 kaiju_tools/rpc/context.py
+-rw-r--r--  2.0 unx      544 b- defN 23-Apr-19 12:08 kaiju_tools/rpc/etc.py
+-rw-r--r--  2.0 unx     1762 b- defN 23-Apr-19 12:08 kaiju_tools/rpc/jsonrpc.py
+-rw-r--r--  2.0 unx    20558 b- defN 23-Apr-19 12:08 kaiju_tools/rpc/server.py
+-rw-r--r--  2.0 unx       71 b- defN 23-Apr-19 12:08 kaiju_tools/rpc/services.py
+-rw-r--r--  2.0 unx     6040 b- defN 23-Apr-19 12:08 kaiju_tools/rpc/sessions.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Apr-19 12:08 kaiju_tools/rpc/tests/__init__.py
+-rw-r--r--  2.0 unx     4207 b- defN 23-Apr-19 12:08 kaiju_tools/rpc/tests/fixtures.py
+-rw-r--r--  2.0 unx     7842 b- defN 23-Apr-19 12:08 kaiju_tools/rpc/tests/test_rpc_server.py
+-rw-r--r--  2.0 unx       38 b- defN 23-Apr-19 12:08 kaiju_tools/streams/__init__.py
+-rw-r--r--  2.0 unx    24457 b- defN 23-Apr-19 12:08 kaiju_tools/streams/abc.py
+-rw-r--r--  2.0 unx      152 b- defN 23-Apr-19 12:08 kaiju_tools/streams/etc.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Apr-19 12:08 kaiju_tools/streams/tests/__init__.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Apr-19 12:08 kaiju_tools/streams/tests/fixtures.py
+-rw-r--r--  2.0 unx     5975 b- defN 23-Apr-19 12:08 kaiju_tools/streams/tests/test_streams.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Apr-19 12:08 kaiju_tools/tests/__init__.py
+-rw-r--r--  2.0 unx     2016 b- defN 23-Apr-19 12:08 kaiju_tools/tests/fixtures.py
+-rw-r--r--  2.0 unx     1408 b- defN 23-Apr-19 12:08 kaiju_tools/tests/test_class_registry.py
+-rw-r--r--  2.0 unx     3385 b- defN 23-Apr-19 12:08 kaiju_tools/tests/test_mapping.py
+-rw-r--r--  2.0 unx      481 b- defN 23-Apr-19 12:08 kaiju_tools/tests/test_serialization.py
+-rw-r--r--  2.0 unx     2787 b- defN 23-Apr-19 12:08 kaiju_tools/tests/test_services.py
+-rw-r--r--  2.0 unx     1554 b- defN 23-Apr-19 12:08 kaiju_tools/tests/test_templates.py
+-rw-r--r--  2.0 unx      796 b- defN 23-Apr-19 12:08 kaiju_tools/tests/test_ttl_dict.py
+-rw-rw-rw-  2.0 unx      610 b- defN 23-Apr-19 12:08 kaiju_tools-2.0.47.dist-info/LICENSE
+-rw-r--r--  2.0 unx     3236 b- defN 23-Apr-19 12:08 kaiju_tools-2.0.47.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-Apr-19 12:08 kaiju_tools-2.0.47.dist-info/WHEEL
+-rw-r--r--  2.0 unx       12 b- defN 23-Apr-19 12:08 kaiju_tools-2.0.47.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     9622 b- defN 23-Apr-19 12:08 kaiju_tools-2.0.47.dist-info/RECORD
+111 files, 397576 bytes uncompressed, 112742 bytes compressed:  71.6%
```

## zipnote {}

```diff
@@ -312,23 +312,23 @@
 
 Filename: kaiju_tools/tests/test_templates.py
 Comment: 
 
 Filename: kaiju_tools/tests/test_ttl_dict.py
 Comment: 
 
-Filename: kaiju_tools-2.0.46.dist-info/LICENSE
+Filename: kaiju_tools-2.0.47.dist-info/LICENSE
 Comment: 
 
-Filename: kaiju_tools-2.0.46.dist-info/METADATA
+Filename: kaiju_tools-2.0.47.dist-info/METADATA
 Comment: 
 
-Filename: kaiju_tools-2.0.46.dist-info/WHEEL
+Filename: kaiju_tools-2.0.47.dist-info/WHEEL
 Comment: 
 
-Filename: kaiju_tools-2.0.46.dist-info/top_level.txt
+Filename: kaiju_tools-2.0.47.dist-info/top_level.txt
 Comment: 
 
-Filename: kaiju_tools-2.0.46.dist-info/RECORD
+Filename: kaiju_tools-2.0.47.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## kaiju_tools/__init__.py

```diff
@@ -4,10 +4,10 @@
 from .es import *
 from .queues import *
 from .cache import *
 from .locks import *
 from .streams import *
 from .docker import *
 
-__version__ = '2.0.46'
+__version__ = '2.0.47'
 __python_version__ = '3.8'
 __author__ = 'antonnidhoggr@me.com'
```

## kaiju_tools/exceptions.py

```diff
@@ -22,14 +22,15 @@
     'MethodNotAllowed',
     'Conflict',
     'JSONParseError',
     'PermissionDenied',
     'NotAuthorized',
     'InvalidLicense',
     'HTTPRequestError',
+    'JSONRPCError',
 ]
 
 
 def ensure_traceback(exc: Exception):
     """Add an empty traceback to the exception which points at this line of code.
 
     This code is required only for Sentry (raven) client to actually recognize an exception. It should be removed
@@ -109,30 +110,34 @@
 
 class JSONParseError(ClientError, ValueError):
     """Wrongly formatted JSON data."""
 
     status_code = -32700
 
 
-class InvalidRequest(ClientError):
+class JSONRPCError(ClientError):
+    """Common JSONRPC error."""
+
+
+class InvalidRequest(JSONRPCError):
     """Invalid RPC request format."""
 
     status_code = -32600
 
 
 MethodNotAllowed = InvalidRequest  # compatibility
 
 
-class MethodNotFound(ClientError):
+class MethodNotFound(JSONRPCError):
     """RPC method does not exist or not available for this type of user."""
 
     status_code = -32601
 
 
-class InvalidParams(ClientError):
+class InvalidParams(JSONRPCError):
     """JSONSchema validation error."""
 
     status_code = -32602
 
     def repr(self) -> dict:
         """Serialize."""
         data = super().repr()
```

## kaiju_tools/http/views.py

```diff
@@ -35,17 +35,20 @@
             if msg.data == 'close':
                 await ws.close()
             else:
                 data = loads(msg.data)
                 counter += 1
                 if 'id' not in data:
                     data['id'] = counter
-                await rpc.call(
+                result = await rpc.call(
                     data, headers=headers, session=session, scope=scope, nowait=True, callback=_send_response
                 )
+                if result:
+                    headers, exc = result
+                    await ws.send_json(exc.repr(), dumps=dumps)
         elif msg.type == WSMsgType.ERROR:
             request.app.logger.error('Websocket error: %s', ws.exception())
 
     if session:
         ws._headers[JSONRPCHeaders.SESSION_ID_HEADER] = session.id  # noqa
 
     return ws
@@ -61,9 +64,11 @@
         """Make an RPC request."""
         if not self.request.can_read_body:
             return Response()
         data = await self.request.text()
         session: Session = self.request.get('session', None)
         scope: Scope = session.scope if session else Scope.GUEST
         rpc: JSONRPCServer = getattr(self.request.app.services, self.rpc_server_name)  # noqa
-        headers, data = await rpc.call(loads(data), headers=dict(self.request.headers), session=session, scope=scope)
+        headers, data = await rpc.call(
+            loads(data), headers=dict(self.request.headers), session=session, scope=scope, nowait=False
+        )
         return json_response(data, headers=headers, dumps=dumps)
```

## kaiju_tools/rpc/client.py

```diff
@@ -34,27 +34,29 @@
         pass
 
     async def call(
         self,
         method: str,
         params: Union[dict, None] = None,
         nowait: bool = False,
+        request_id: int = 0,
         max_timeout: int = None,
         use_context: bool = True,
     ) -> Union[Any, None]:
         """Make an RPC call.
 
         :param method: rpc method name
         :param params: method call arguments
         :param nowait: create a 'notify' request - do not wait for the result
+        :param request_id: optional request id (usually you don't need to set it)
         :param max_timeout: request timeout in sec
         :param use_context: use app request context such as correlation id and request chain deadline
         """
         headers = self._create_request_headers(max_timeout, use_context, nowait)
-        _id = None if nowait else 0
+        _id = None if nowait else request_id
         body = RPCRequest(id=_id, method=method, params=params)
         response = await self._request(body, headers)
         result = self._process_response(response)
         if isinstance(result, Exception):
             raise result
         return result
```

## kaiju_tools/rpc/jsonrpc.py

```diff
@@ -16,32 +16,30 @@
 class RPCRequest(RPCMessage):
     """Valid JSONRPC request."""
 
     __slots__ = ('id', 'method', 'params')
 
     def __init__(
         self,
-        id: Union[int, None] = False,
+        id: Union[int, None],
         method: str = None,
         params: Union[list, dict] = None,
         jsonrpc=None,  # noqa I know
     ):
         """Initialize."""
-        if id is False:
-            self.id = 0
-        else:
-            self.id = id
-        if method is None:
-            raise TypeError()
+        self.id = id
         self.method = method
         self.params = params
 
     def repr(self):
         """Create a JSONRPC body."""
-        return {'jsonrpc': JSONRPC, 'id': self.id, 'method': self.method, 'params': self.params}
+        data = {'jsonrpc': JSONRPC, 'id': self.id, 'method': self.method}
+        if self.params:
+            data['params'] = self.params
+        return data
 
 
 class RPCResponse(RPCMessage):
     """Valid JSON RPC response."""
 
     __slots__ = ('id', 'result')
```

## kaiju_tools/rpc/server.py

```diff
@@ -2,40 +2,44 @@
 import inspect
 import os
 import warnings
 from binascii import b2a_hex
 from fnmatch import fnmatch
 from textwrap import dedent
 from time import time
-from typing import List, Union, TypedDict, Callable, Dict, Optional, Tuple, Awaitable
+from typing import List, Union, TypedDict, Callable, Dict, Optional, Tuple, Awaitable, NewType
 
 import fastjsonschema  # noqa pycharm?
 
 from kaiju_tools.rpc.abc import AbstractRPCCompatible
 from kaiju_tools.rpc.etc import JSONRPCHeaders
 from kaiju_tools.rpc.sessions import BaseSessionService
-from kaiju_tools.rpc.jsonrpc import RPCRequest, RPCError, RPCResponse
+from kaiju_tools.rpc.jsonrpc import RPCError, RPCResponse
 from kaiju_tools.functions import timeout
 from kaiju_tools.exceptions import (
     APIException,
     RequestTimeout,
     InternalError,
     InvalidRequest,
     InvalidParams,
     Aborted,
     MethodNotFound,
     PermissionDenied,
+    JSONRPCError,
 )
 from kaiju_tools.services import ContextableService, RequestContext, Session, Scope
 from kaiju_tools.jsonschema import compile_schema
 from .context import REQUEST_CONTEXT, REQUEST_SESSION
 
 __all__ = ['RequestHeaders', 'MethodInfo', 'JSONRPCServer']
 
 
+_RequestId = NewType('_RequestId', Union[int, None])
+
+
 class _Aborted(APIException):
     pass
 
 
 class RequestHeaders(TypedDict):
     """Request headers acknowledged by the server."""
 
@@ -135,33 +139,35 @@
     def permissions(self):
         return {
             'routes': self.PermissionKeys.GLOBAL_GUEST_PERMISSION,
             'info': self.PermissionKeys.GLOBAL_SYSTEM_PERMISSION,
         }
 
     async def get_info(self) -> dict:
-        """Get all currently running tasks."""
+        """Get server status and current tasks."""
         tasks = asyncio.all_tasks(asyncio.get_running_loop())
         t = int(time())
         return {
+            'app_id': self.app.id,
             'total_tasks': len(tasks),
             'rpc_tasks': self._max_parallel_tasks - self._counter,
-            'server_time': int(time()),
+            'queue_full': not self._not_full.is_set(),
+            'server_time': t,
             'max_tasks': self._max_parallel_tasks,
             'max_timeout': self._max_request_time,
             'default_timeout': self._default_request_time,
             'enable_permissions': self._enable_permissions,
             'tasks': [
                 {
-                    'correlation_id': task.get_name().replace('rpc ', '', 1),
-                    'time_elapsed': t - task.started,  # noqa (added at call)
-                    'time_left': task.deadline - task.started,  # noqa (added at call)
+                    'cid': task.get_name()[4:],
+                    'time_elapsed': t - task.started,  # noqa (should be added in call)
+                    'time_left': task.deadline - task.started,  # noqa (should be added in call)
                 }
                 for task in tasks
-                if task.get_name().startswith('rpc ')
+                if task.get_name().startswith('rpc:')
             ],
         }
 
     async def get_routes(self, pattern: str = '*') -> list:
         """Get all RPC routes (you are here)."""
         session = self.get_session()
         routes = [
@@ -218,49 +224,59 @@
         self,
         body: Union[List, Dict],
         headers: dict = None,
         session: Session = None,
         nowait: bool = False,
         scope: Scope = Scope.SYSTEM,
         callback: Callable[..., Awaitable] = None,
-    ) -> asyncio.Task:
+    ) -> (dict, RequestHeaders):
         """Call a server command.
 
         :param body: request body
         :param headers: request headers (optional)
         :param session: client session object
         :param scope: user scope
         :param nowait: do not wait for the result
         :param callback: optional response callback which should contain (session, headers, result) input params
         """
         headers = self._get_request_headers(headers)
         if type(body) in {list, tuple}:
+            try:
+                reqs = [self._prepare_request(req, session, scope, n, nowait) for n, req in enumerate(body)]
+            except JSONRPCError as exc:
+                headers = self._get_response_headers(headers['correlation_id'], session)
+                return headers, RPCError(id=exc.data.get('id'), error=exc)
             coro = self._execute_batch(
-                body,
+                reqs,
                 request_deadline=headers['request_deadline'],
                 abort_on_error=headers['abort_on_error'],
                 session=session,
-                scope=scope,
                 correlation_id=headers['correlation_id'],
                 callback=callback,
             )
         else:
+            try:
+                req_id, coro, body = self._prepare_request(body, session, scope, 0, nowait)
+            except JSONRPCError as exc:
+                headers = self._get_response_headers(headers['correlation_id'], session)
+                return headers, RPCError(id=exc.data.get('id'), error=exc)
             coro = self._execute_single(
-                body,
+                coro,
+                request_id=req_id,
+                body=body,
                 request_deadline=headers['request_deadline'],
                 session=session,
-                scope=scope,
                 correlation_id=headers['correlation_id'],
                 callback=callback,
             )
         self._counter -= 1
         if not self._not_full.is_set():
             await self._not_full.wait()
         task = asyncio.create_task(coro)
-        task.set_name(f'rpc {headers["correlation_id"]}')
+        task.set_name(f'rpc:{headers["correlation_id"]}')
         setattr(task, 'deadline', headers['request_deadline'])
         setattr(task, 'started', int(time()))
         task.add_done_callback(self._request_done_cb)
         if self._empty.is_set():
             self._empty.clear()
         if self._counter <= 0:
             self._counter = 0
@@ -305,90 +321,92 @@
             correlation_id=headers.get(JSONRPCHeaders.CORRELATION_ID_HEADER, b2a_hex(os.urandom(4)).decode()),
             request_deadline=request_deadline,
             abort_on_error=self._parse_boolean_value(headers.get(JSONRPCHeaders.ABORT_ON_ERROR), False),
         )
 
     async def _execute_single(
         self,
-        body,
+        coro,
+        request_id: _RequestId,
+        body: dict,
         request_deadline: int,
         session: Optional[Session],
-        scope: Scope,
         correlation_id: Optional[str],
         callback: Callable[..., Awaitable],
     ) -> Tuple[dict, Union[RPCResponse, RPCError]]:
         ctx = RequestContext(
             session_id=session.id if session else None,
             request_deadline=request_deadline,
             correlation_id=correlation_id,
         )
         REQUEST_SESSION.set(session)
         REQUEST_CONTEXT.set(ctx)
         try:
             async with timeout(request_deadline - time()):
-                result = await self._execute_request(body, id_=0, session=session, scope=scope)
+                result = await self._execute_request(coro, request_id, body)
         except asyncio.TimeoutError:
             result = RPCError(
-                id=None, error=RequestTimeout(message='Request timeout', request_deadline=request_deadline)
+                id=request_id, error=RequestTimeout(message='Request timeout', request_deadline=request_deadline)
             )
         session = self.get_session()
         if self._sessions and session and session.stored and session.changed:
             await self._sessions.save_session(session)
         if result.id is not None or type(result) is not RPCResponse:
             headers = self._get_response_headers(correlation_id, session)
             if callback:
-                await callback(session, headers, result)
+                coro = callback(session, headers, result)
+                asyncio.create_task(coro)  # noqa  TODO: find how to type hint callback properly
             return headers, result
 
     @staticmethod
     def _get_response_headers(correlation_id: str, session: Optional[Session]) -> dict:
         headers = {}
         if correlation_id:
             headers[JSONRPCHeaders.CORRELATION_ID_HEADER] = correlation_id
         if session and session.stored and (session.changed or session.loaded):
             headers[JSONRPCHeaders.SESSION_ID_HEADER] = session.id
         return headers
 
     async def _execute_batch(
         self,
-        request: List[dict],
+        requests: List[Tuple[_RequestId, Awaitable, dict]],
         request_deadline: int,
         abort_on_error: bool,
         session: Optional[Session],
-        scope: Scope,
         correlation_id: Optional[str],
         callback: Callable[..., Awaitable],
     ) -> Tuple[dict, List[Union[RPCResponse, RPCError]]]:
         """Execute multiple coroutine functions."""
         ctx = RequestContext(
             session_id=session.id if session else None,
             request_deadline=request_deadline,
             correlation_id=correlation_id,
         )
         REQUEST_SESSION.set(session)
         REQUEST_CONTEXT.set(ctx)
         results = []
-        for n, row in enumerate(request):
+        for n, (req_id, coro, body) in enumerate(requests):
             try:
                 async with timeout(request_deadline - time()):
-                    result = await self._execute_request(row, id_=n, session=session, scope=scope)
+                    result = await self._execute_request(coro, req_id, body)
                     if abort_on_error and isinstance(result, RPCError):
                         raise _Aborted
             except _Aborted:
                 results.extend(
-                    (RPCError(id=id_, error=Aborted(message='Aborted by the server')) for id_ in range(n, len(request)))
+                    (RPCError(id=req_id, error=Aborted(message='Aborted')) for req_id, coro, body in requests[n:])
                 )
                 break
             except asyncio.TimeoutError:
                 results.extend(
                     (
                         RPCError(
-                            id=id_, error=RequestTimeout(message='Request timeout', request_deadline=request_deadline)
+                            id=req_id,
+                            error=RequestTimeout(message='Request timeout', request_deadline=request_deadline),
                         )
-                        for id_ in range(n, len(request))
+                        for req_id, coro, body in requests[n:]
                     )
                 )
                 break
             else:
                 if result.id is not None or type(result) is not RPCResponse:
                     results.append(result)
         session = self.get_session()
@@ -396,81 +414,102 @@
             await self._sessions.save_session(session)
         headers = self._get_response_headers(correlation_id, session)
         if results:
             if callback:
                 await callback(session, headers, results)
             return headers, results
 
-    async def _execute_request(
-        self, request: dict, id_, session: Optional[Session], scope: Scope
-    ) -> Union[RPCResponse, RPCError]:
-        if type(request) is not dict:
-            raise InvalidRequest(id=id_, message='Request body must be a JSONRPC object.')
-        if 'id' not in request:
-            request['id'] = id_
-        try:
-            request = RPCRequest(**request)
-            id_ = request.id
-        except Exception as exc:
-            return RPCError(id=id_, error=InvalidRequest(base_exc=exc, debug=self._debug, message=str(exc)))
-        if request.params is None:
-            params = {}
-        elif type(request.params) is dict:
-            params = request.params
+    def _prepare_request(
+        self, body, session: Optional[Session], scope: Scope, default_id: int, nowait: bool
+    ) -> (_RequestId, Awaitable):
+        """Pre-validate and prepare request for the execution."""
+        # request body validation
+        if type(body) is not dict:
+            raise InvalidRequest(id=None, message='Request must be an object')
+        if nowait:
+            body['id'] = _id = None
+        elif 'id' not in body:
+            body['id'] = _id = default_id
         else:
-            return RPCError(id=id_, error=InvalidParams(message='Request params must be a mapping or null'))
+            _id = body['id']
+            if _id is not None and type(_id) is not int:
+                raise InvalidRequest(id=None, message='Request "id" must be an integer or null', request_id=_id)
+
+        # method visibility check
+
+        method_name = body.get('method')
+        if not method_name:
+            raise InvalidRequest(id=_id, message='Request "method" must be a string', request_method=method_name)
         try:
-            method = self._methods[request.method]
+            method = self._methods[method_name]
         except KeyError:
-            return RPCError(id=id_, error=MethodNotFound(id=id_, method=request.method))
-        if method['validator']:
-            try:
-                params = method['validator'](params)
-            except fastjsonschema.JsonSchemaException as exc:
-                return RPCError(id=id_, error=InvalidParams(id=id_, message=str(exc), base_exc=exc))
-        if self._enable_permissions and scope != Scope.SYSTEM:
-            if all(
-                (
-                    method['permission'].value < scope.value,
-                    session and request.method not in session.permissions,
-                    session and method['service_name'] not in session.permissions,
-                )
-            ):
-                return RPCError(id=id_, error=PermissionDenied(id=id_, method=request.method))
+            raise MethodNotFound(id=_id, message='Method not found', request_method=method_name)
+        else:
+            if self._enable_permissions:
+                if all(
+                    (
+                        method['permission'].value < scope.value,
+                        session and method_name not in session.permissions,
+                        session and method['service_name'] not in session.permissions,
+                    )
+                ):
+                    raise PermissionDenied(id=_id, message='Method not found', request_method=method_name)
+
+        # request params validation
+
+        params = body.get('params')
+        if params is None:
+            params = {}
+        else:
+            params = {k: v for k, v in params.items() if not k.startswith('_')}
+        if params:
+            if not type(params) is dict:
+                raise InvalidParams(id=_id, message='Request "params" must be an object', request_params=params)
+            if method['validator']:
+                try:
+                    params = method['validator'](params)
+                except Exception as exc:
+                    raise InvalidParams(id=_id, message=str(exc), base_exc=exc)
+
+        # coro construction
+
         try:
             coro = method['f'](**params)
         except Exception as exc:
-            return RPCError(id=request.id, error=InvalidParams(base_exc=exc, message=str(exc)))
+            raise InvalidParams(id=_id, message=str(exc), base_exc=exc)
+        else:
+            return _RequestId(_id), coro, body
+
+    async def _execute_request(
+        self,
+        coro: Awaitable,
+        request_id: _RequestId,
+        request: dict,
+    ) -> Union[RPCResponse, RPCError]:
+        """Execute a coro and process an exception."""
         if self._request_logs:
-            _log_req = request if self._full_request_logs else dict(id=request.id, method=request.method, params='...')
-            self.logger.info('rpc accepted', request=_log_req)
-        _error, _exc = False, None
+            if not self._full_request_logs:
+                request['params'] = '...'
+            self.logger.info('rpc accepted', request=request)
         try:
             result = await coro
-            result = RPCResponse(id=id_, result=result)
-        except asyncio.TimeoutError:
-            result = RPCError(id=request.id, error=RequestTimeout(id=id_, message='Request timeout'))
-            _error = True
-            _exc = None
+            result = RPCResponse(id=request_id, result=result)
+            _error = False
         except APIException as exc:
-            exc.debug = self._debug
-            result = RPCError(id=request.id, error=exc)
-            _error = True
-            _exc = exc
+            _error, result = True, exc
         except Exception as exc:
-            result = RPCError(
-                id=request.id, error=InternalError(base_exc=exc, debug=self._debug, message='Internal error')
-            )
-            _error = True
-            _exc = exc
+            _error, result = True, InternalError(base_exc=exc, message='Internal error')
         if _error:
-            self.logger.info('rpc error', request=request, exc_info=_exc)
+            if self._debug:
+                result.debug = True
+            self.logger.info('rpc error', request=request, exc_info=result)
+            result = RPCError(id=request_id, error=result)
         elif self._request_logs:
             _result = result.result if self._full_request_logs else '...'
-            self.logger.info('rpc finished', request=_log_req, result=_result)  # noqa
+            self.logger.info('rpc finished', request=request, result=_result)
         return result
 
     def _request_done_cb(self, task: asyncio.Task) -> None:
         """Increment the counter when a request is finished."""
         self._counter += 1
         if self._counter >= self._max_parallel_tasks:
             self._counter = self._max_parallel_tasks
```

## kaiju_tools/rpc/tests/test_rpc_server.py

```diff
@@ -62,19 +62,19 @@
         service = rpc_compatible_service(app=rpc.app, logger=logger)
         rpc.register_service(service.service_name, service)
 
         correlation_id = uuid4()
 
         logger.info('Testing basic requests.')
 
-        data = {'method': 'm.echo', 'params': None}
+        data = {'method': 'm.echo'}
         _headers, response = await rpc.call(data, {})
         assert response.result == ((), {})
 
-        data = {'id': None, 'method': 'm.echo', 'params': None}
+        data = {'id': None, 'method': 'm.echo'}
         _result = await rpc.call(data, {})
         assert _result is None
 
         data = {'id': uuid4().int, 'method': 'm.echo', 'params': {'value': 42}}
         _headers, response = await rpc.call(data, {})
         assert response.result[1]['value'] == 42
 
@@ -118,73 +118,75 @@
         _headers, response = await rpc.call(data, {})
         assert isinstance(response.error, MethodNotFound)
 
         data = {'id': uuid4().int}
         _headers, response = await rpc.call(data, {})
         assert isinstance(response.error, InvalidRequest)
 
-        data = {'id': uuid4().int, 'method': 'm.unknown', 'params': {'value': True}, 'shit': 1}
-        _headers, response = await rpc.call(data, {})
-        assert isinstance(response.error, InvalidRequest)
+        # data = {'id': uuid4().int, 'method': 'm.unknown', 'params': {'value': True}, 'shit': 1}
+        # _headers, response = await rpc.call(data, {})
+        # assert isinstance(response.error, InvalidRequest)
 
         data = {'id': uuid4().int, 'method': 'm.sum', 'params': {'x': 1, 'z': '2'}}
         _headers, response = await rpc.call(data, {})
         assert isinstance(response.error, InvalidParams)
 
-        data = {'id': uuid4().int, 'method': 'm.fail', 'params': None}
+        data = {'id': uuid4().int, 'method': 'm.fail'}
         _headers, response = await rpc.call(data, {})
         assert isinstance(response.error, InternalError)
 
         logger.info('Testing timeouts.')
 
         headers = {}
 
-        data = {'id': uuid4().int, 'method': 'm.long_echo', 'params': None}
+        data = {'id': uuid4().int, 'method': 'm.long_echo'}
         headers[JSONRPCHeaders.REQUEST_TIMEOUT_HEADER] = 1
         _headers, response = await rpc.call(data, headers)
         assert isinstance(response.error, RequestTimeout)
 
-        data = {'id': uuid4().int, 'method': 'm.long_echo', 'params': None}
+        data = {'id': uuid4().int, 'method': 'm.long_echo'}
         headers[JSONRPCHeaders.REQUEST_TIMEOUT_HEADER] = 10
         _headers, response = await rpc.call(data, headers)
         assert isinstance(response, RPCResponse)
 
         logger.info('Testing for parallel task execution')
 
         tasks = []
 
         for _ in range(4):
-            data = {'id': uuid4().int, 'method': 'm.standard_echo', 'params': None}
+            data = {'id': uuid4().int, 'method': 'm.standard_echo'}
             headers[JSONRPCHeaders.REQUEST_DEADLINE_HEADER] = int(time() + 1)
             headers[JSONRPCHeaders.CORRELATION_ID_HEADER] = correlation_id
             tasks.append(rpc.call(data, headers))
 
         t = time()
         await asyncio.gather(*tasks)
         t = time() - t
         assert t <= 1
 
         logger.info('Testing separate bulk request error handling.')
 
         data = [
-            {'method': 'm.echo', 'params': None},
-            {'method': 'm.long_echo', 'params': None},
-            {'method': 'm.fail', 'params': None},
+            {'method': 'm.echo'},
+            {'method': 'm.long_echo'},
+            {'method': 'm.fail'},
             {'method': 'm.sum', 'params': {'x': 1, 'y': 2}},
         ]
         headers[JSONRPCHeaders.REQUEST_DEADLINE_HEADER] = int(time() + 1)
         _headers, response = await rpc.call(data, headers)
         assert isinstance(response[1].error, RequestTimeout)
         assert isinstance(response[2], RPCError)
 
         logger.info('Testing context handling.')
 
-        session_1 = SimpleNamespace(id='1', test=True, permission=frozenset(), stored=True, loaded=False, changed=True)
-        session_2 = SimpleNamespace(id='2', test=False, permission=frozenset(), stored=True, loaded=True, changed=False)
-        data = {'id': uuid4().int, 'method': 'm.uses_context', 'params': None}
+        session_1 = SimpleNamespace(id='1', test=True, permissions=frozenset(), stored=True, loaded=False, changed=True)
+        session_2 = SimpleNamespace(
+            id='2', test=False, permissions=frozenset(), stored=True, loaded=True, changed=False
+        )
+        data = {'id': uuid4().int, 'method': 'm.uses_context'}
         r1, r2 = await asyncio.gather(rpc.call(data, {}, session=session_1), rpc.call(data, {}, session=session_2))
         assert r1[0][JSONRPCHeaders.SESSION_ID_HEADER] == session_1.id
         assert r2[0][JSONRPCHeaders.SESSION_ID_HEADER] == session_2.id
 
         logger.info('Testing permissions handling.')
         session = SimpleNamespace(id='1', permissions=set(), stored=True, loaded=True, changed=True)
         _, response = await rpc.call({'method': 'm.method_with_user_permission'}, session=session, scope=Scope.GUEST)
```

## Comparing `kaiju_tools-2.0.46.dist-info/LICENSE` & `kaiju_tools-2.0.47.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `kaiju_tools-2.0.46.dist-info/METADATA` & `kaiju_tools-2.0.47.dist-info/METADATA`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: kaiju-tools
-Version: 2.0.46
+Version: 2.0.47
 Summary: Base classes and services for a backend application.
 Home-page: https://gitlab.com/kaiju-python/kaiju-tools
 Author: antonnidhoggr@me.com
 Author-email: antonnidhoggr@me.com
 License: Apache Software License 2.0
 Classifier: Development Status :: 3 - Alpha
 Classifier: License :: OSI Approved :: Apache Software License
```

## Comparing `kaiju_tools-2.0.46.dist-info/RECORD` & `kaiju_tools-2.0.47.dist-info/RECORD`

 * *Files 2% similar despite different names*

```diff
@@ -1,11 +1,11 @@
 kaiju_tools/CLI.py,sha256=JAggZ74FQZmu-Wr5vYzy0-dMB5zH3vQewDGe2lnW5eo,3424
-kaiju_tools/__init__.py,sha256=IACV0ka9kNzv1ErZvQzXMdIz5KENO8vvJygCN2EfbzQ,272
+kaiju_tools/__init__.py,sha256=YMTU8MBYJBGwrOWyJZdftGNpH32L5MHA1hjzX9jPARI,272
 kaiju_tools/class_registry.py,sha256=sKn9YmblEeTBhcC_ivoGGTlBFXMG2G2WAsztdk1xBcE,7473
-kaiju_tools/exceptions.py,sha256=pHvyYkHQQagiSY2PCba3b4l01pYxrADMZX6uknqjrJ4,5923
+kaiju_tools/exceptions.py,sha256=DJrtHxE3oWR9p7il2E8Q3r0P-JSKcDkwo57lcy74604,6013
 kaiju_tools/fixtures.py,sha256=h1ElRgENikjde-uXvk_exA_SvMPuxqtxo0qaiYDhCWk,997
 kaiju_tools/functions.py,sha256=LVxnviuH2wwif3TChnXOcNOR9WCWMnafqezV27pRBEc,8965
 kaiju_tools/init_app.py,sha256=J5eDuiZqskrBWSjgM2d8CdsYkt28nqgrOLT4Ms8AZjg,2172
 kaiju_tools/jsonschema.py,sha256=1akEqwrcaD7wgvTmEUpkjRrvw7ILWh8iPfn8YRGK0h8,18691
 kaiju_tools/loop.py,sha256=Nkih75UgPen5SvZYSU0XFb9cbH6Zle-Nbto0B_wpn50,195
 kaiju_tools/mapping.py,sha256=JOloXn-etuB0EsaZ6spbZSDK3wlQ-vHIfkt2Za8-AzE,13521
 kaiju_tools/serialization.py,sha256=GHby_IRwIPVypPL4M76nBs_GjezMXU4wvZV6D9LhqNc,159
@@ -51,15 +51,15 @@
 kaiju_tools/es/schema.py,sha256=dvf4yhWGxPEAcWQv1LeIJNU9_Yc6Dcm0lxIl9TwE8hI,17588
 kaiju_tools/es/services.py,sha256=XLYIrzW4QnfsqWYK9vLT43i5dHqICAza6E1vEP0NVyw,66
 kaiju_tools/es/tests/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 kaiju_tools/es/tests/fixtures.py,sha256=x4kOyRAGt6tqACFbojRNxqNITdE1_V_TRxWybf9h2dE,3463
 kaiju_tools/http/__init__.py,sha256=WjPNiFMweQ3tqGMUeqV4ubNc7GDRicBffNEmyqBhnw4,32
 kaiju_tools/http/client.py,sha256=Ez0zGImFx-5OfldOsMojG01r3LVUn9qkYZ_LeM_b4EU,6055
 kaiju_tools/http/middlewares.py,sha256=-mpWy-BnWVvlwliLBgQ8ZG_o2R4m1Mb7PDWmFpAo7Cs,1238
-kaiju_tools/http/views.py,sha256=Ebfs9Ku3sdyTBEmsrv2MuPbaXWDH8V9HvZ1EEo8z0S0,2564
+kaiju_tools/http/views.py,sha256=GkZO-rNRp-n02xb46kH_LshmXo0-kq93KHfPCxfuXfo,2742
 kaiju_tools/http/tests/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 kaiju_tools/http/tests/test_client.py,sha256=pBmui1LF98Z5v-kadTCvvdDXSfufeuBkraAg4kJ2s_Y,1532
 kaiju_tools/http/tests/test_rpc_rest_view.py,sha256=quDgkyns94NU1fHG2hTqVLcpGDpmiM9cJlR6vLSIpOY,2392
 kaiju_tools/locks/__init__.py,sha256=bkVd3bN1kZCPi3PfnV7ZQLHWjq86vAf-aE2ZVNZF5ug,2344
 kaiju_tools/locks/abc.py,sha256=vgpYLSlPQcMzUO_1mbnOJ3_NHMBtHg_p3mAEULucVxs,9911
 kaiju_tools/locks/etc.py,sha256=TFrcXD-qJg1ZDp6-2Wy6bLC1DCHB9XAji8WQ7oxYt-A,393
 kaiju_tools/locks/exceptions.py,sha256=ZCo4Q8IMbbOe81raMdDi6j-M1kQ2wdv1PbuR9Fsr9x8,284
@@ -75,37 +75,37 @@
 kaiju_tools/queues/queue.py,sha256=KZiDqIzDND450GhXvlpHez_NvXtwaM1l1G0V-RdvqjQ,3828
 kaiju_tools/queues/services.py,sha256=OImkKf_9d62qK_OYl51tHPTiwlQo1w545BGMfna-SBg,33
 kaiju_tools/queues/tests/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 kaiju_tools/queues/tests/fixtures.py,sha256=-9qRWUUnl_3EHnd-leRuDOK16y80sR-H1a5gXw4F4Ws,722
 kaiju_tools/queues/tests/test_queue.py,sha256=v8aD-5JrYj-ByAWI48X1y7MmyOgNE9Bfw2dIJpsRbww,1371
 kaiju_tools/rpc/__init__.py,sha256=1_nq0D65USGIS2jXxF_88fR-LfaiXXF-PqNBTlpkWkg,43
 kaiju_tools/rpc/abc.py,sha256=XfmsF66rP3wvW0_LGPx3JpU4NF_NWqNZg-DLDBb8Nzw,11883
-kaiju_tools/rpc/client.py,sha256=wfv0Xt-xV15i7cS0IzIlSfOd6PVOzbzH2fi7QtLbT9Q,4991
+kaiju_tools/rpc/client.py,sha256=mjbdx2kL2ZWuG6cLFfeLw4eygsX0LI6Ax6SqL3xNjOw,5111
 kaiju_tools/rpc/client_gen.py,sha256=pL3afEvDJIlD5SorfEtSj64Ef5JolYLTkVYPs3fpohw,3825
 kaiju_tools/rpc/context.py,sha256=l27TATs8IKs4f_690JRn75WY7TsjXWInDgqUrCP03FU,116
 kaiju_tools/rpc/etc.py,sha256=rUByIq3pv6hQektlthEeyWrRjloWPLuokNMK7frWZ9k,544
-kaiju_tools/rpc/jsonrpc.py,sha256=od8Y9AOsbnhsV5hbilv--TR7F56hbkTgVar69WSsi0I,1831
-kaiju_tools/rpc/server.py,sha256=ndqeXFRxshy2Hhvg_AZDZ_0hoM5R9kKTPwxKbKSoJRY,19150
+kaiju_tools/rpc/jsonrpc.py,sha256=aZ2NE8vczDsdOe8EjlzqmliGLlmbwxNkmSoUeSSSJg8,1762
+kaiju_tools/rpc/server.py,sha256=0_8qIfCjhfTsZxaQSGhtte9bwFOAaPC6QfHsAYAFbKk,20558
 kaiju_tools/rpc/services.py,sha256=FgR7DpZTKjYBx7ieXKHkh4Lqrqe910c_iAiKxTOcdIk,71
 kaiju_tools/rpc/sessions.py,sha256=PfE_EfoP-Ilgp6RI_AvavkVfog8R4FGAQIYuZnv3OoE,6040
 kaiju_tools/rpc/tests/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 kaiju_tools/rpc/tests/fixtures.py,sha256=6NUdBeZA3a_vrRe5oLTyDGU3FCqD5JwqZlXd1xFpsb8,4207
-kaiju_tools/rpc/tests/test_rpc_server.py,sha256=Lb4SstLkv8Qqw3YDujgRqmUHW3Fnk2SHZOtpv98tGeo,7972
+kaiju_tools/rpc/tests/test_rpc_server.py,sha256=O-WLG9JMoxZKboy7KoEZAv3yNYmU0PHc5J9kHwdG1W4,7842
 kaiju_tools/streams/__init__.py,sha256=pHOdZ9DDYEMdr3EjCBCuNqYGY1hLqWwTU2v64vPCHP4,38
 kaiju_tools/streams/abc.py,sha256=K7D3HESwaYNZ_frxFKeTS92sDP4Qul2821T_7Z5hp2I,24457
 kaiju_tools/streams/etc.py,sha256=xAaOal-vRdGluvVOL698eY7TdpV-lboqH39DEFWeP5c,152
 kaiju_tools/streams/tests/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 kaiju_tools/streams/tests/fixtures.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 kaiju_tools/streams/tests/test_streams.py,sha256=xB-Dv5RppQMi66U-aZ1IdfJ147ZDdpjM-nCrAjJCdP4,5975
 kaiju_tools/tests/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 kaiju_tools/tests/fixtures.py,sha256=k1Ou6JiYt4XM4-6zMVzO23fPyD4yFslrF3gbbwl6SlU,2016
 kaiju_tools/tests/test_class_registry.py,sha256=D9mZu9sgY21gEWE8vp2HN0Vfb5WZqxWTNVRPWEPduhU,1408
 kaiju_tools/tests/test_mapping.py,sha256=HzxgQo-k2cBPE88F4AnhBv_Ixb0YS-dWL5rQtM_MRVE,3385
 kaiju_tools/tests/test_serialization.py,sha256=9ETlE5i8b2WFwKsTrECVuB14Pkxf4QgCc6oFX_yjMZw,481
 kaiju_tools/tests/test_services.py,sha256=fYhWYsp-aAyIYwAcLx0ScZhBLBPEX6Apf2LRVWe-WX8,2787
 kaiju_tools/tests/test_templates.py,sha256=XQfGPY1FEIUhZZg4DZQYGTS887xFlPEfyQf0USjJYOw,1554
 kaiju_tools/tests/test_ttl_dict.py,sha256=HWuoDepQdEWixOBlYhCzR1RVLHz20jXwa4SWrrr0A7o,796
-kaiju_tools-2.0.46.dist-info/LICENSE,sha256=XIlN2qA8UqpBDA-PteoYP4hTU0qBW0G9PRB__khO2zc,610
-kaiju_tools-2.0.46.dist-info/METADATA,sha256=hrbE7U5Ks0zAj3wXIjB12QSceUFcMq2NHRRN7lC9L8g,3236
-kaiju_tools-2.0.46.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
-kaiju_tools-2.0.46.dist-info/top_level.txt,sha256=DIgXUScFnJtRLiRWfjo547JK4rMuTIJoioMPRe1Jn6Y,12
-kaiju_tools-2.0.46.dist-info/RECORD,,
+kaiju_tools-2.0.47.dist-info/LICENSE,sha256=XIlN2qA8UqpBDA-PteoYP4hTU0qBW0G9PRB__khO2zc,610
+kaiju_tools-2.0.47.dist-info/METADATA,sha256=I1p1U69WEx93RjygZXcCaHIfzFtZroHD5o3w1efu_uU,3236
+kaiju_tools-2.0.47.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
+kaiju_tools-2.0.47.dist-info/top_level.txt,sha256=DIgXUScFnJtRLiRWfjo547JK4rMuTIJoioMPRe1Jn6Y,12
+kaiju_tools-2.0.47.dist-info/RECORD,,
```

